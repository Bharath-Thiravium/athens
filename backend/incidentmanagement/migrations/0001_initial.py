# Generated by Django 5.2.5 on 2025-08-28 02:42

import django.core.validators
import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('authentication', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='IncidentCategory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True, verbose_name='Category Name')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('color_code', models.CharField(default='#007bff', max_length=7, verbose_name='Color Code')),
                ('is_active', models.BooleanField(default=True, verbose_name='Is Active')),
                ('sort_order', models.IntegerField(default=0, verbose_name='Sort Order')),
                ('industry_type', models.CharField(choices=[('construction', 'Construction'), ('manufacturing', 'Manufacturing'), ('oil_gas', 'Oil & Gas'), ('chemical', 'Chemical'), ('mining', 'Mining'), ('general', 'General')], default='general', max_length=50, verbose_name='Industry Type')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Incident Category',
                'verbose_name_plural': 'Incident Categories',
                'ordering': ['sort_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='EightDProcess',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('eight_d_id', models.CharField(help_text='Auto-generated unique 8D identifier', max_length=20, unique=True, verbose_name='8D ID')),
                ('problem_statement', models.TextField(help_text='Clear, concise problem statement (D2)', verbose_name='Problem Statement')),
                ('initiated_date', models.DateTimeField(auto_now_add=True, verbose_name='Initiated Date')),
                ('target_completion_date', models.DateTimeField(blank=True, null=True, verbose_name='Target Completion Date')),
                ('actual_completion_date', models.DateTimeField(blank=True, null=True, verbose_name='Actual Completion Date')),
                ('status', models.CharField(choices=[('initiated', 'Initiated'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('closed', 'Closed'), ('cancelled', 'Cancelled')], default='initiated', max_length=20, verbose_name='8D Status')),
                ('current_discipline', models.IntegerField(default=1, help_text='Current 8D step (1-8)', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(8)], verbose_name='Current Discipline')),
                ('overall_progress', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Overall Progress (%)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('champion', models.ForeignKey(help_text='Person responsible for the 8D process', on_delete=django.db.models.deletion.CASCADE, related_name='eight_d_processes_championed', to=settings.AUTH_USER_MODEL, verbose_name='8D Champion')),
            ],
            options={
                'verbose_name': '8D Process',
                'verbose_name_plural': '8D Processes',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='EightDPreventionAction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('prevention_description', models.TextField(help_text='Detailed description of the prevention action', verbose_name='Prevention Action Description')),
                ('prevention_type', models.CharField(choices=[('process_change', 'Process Change'), ('system_update', 'System Update'), ('training', 'Training Program'), ('procedure_update', 'Procedure Update'), ('design_change', 'Design Change'), ('control_enhancement', 'Control Enhancement'), ('monitoring', 'Monitoring System'), ('other', 'Other')], default='process_change', max_length=20, verbose_name='Prevention Type')),
                ('scope_of_application', models.TextField(help_text='Where and how this prevention action will be applied', verbose_name='Scope of Application')),
                ('target_date', models.DateField(verbose_name='Target Implementation Date')),
                ('implementation_date', models.DateField(blank=True, null=True, verbose_name='Implementation Date')),
                ('status', models.CharField(choices=[('planned', 'Planned'), ('in_progress', 'In Progress'), ('implemented', 'Implemented'), ('verified', 'Verified'), ('effective', 'Effective')], default='planned', max_length=20, verbose_name='Status')),
                ('verification_method', models.TextField(help_text='How prevention effectiveness will be verified', verbose_name='Verification Method')),
                ('verification_date', models.DateField(blank=True, null=True, verbose_name='Verification Date')),
                ('effectiveness_notes', models.TextField(blank=True, help_text='Notes on prevention effectiveness', verbose_name='Effectiveness Notes')),
                ('similar_processes', models.TextField(blank=True, help_text='Other processes where this prevention should be applied', verbose_name='Similar Processes')),
                ('rollout_plan', models.TextField(blank=True, help_text='Plan for rolling out prevention to similar processes', verbose_name='Rollout Plan')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('responsible_person', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='prevention_actions_responsible', to=settings.AUTH_USER_MODEL)),
                ('eight_d_process', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='prevention_actions', to='incidentmanagement.eightdprocess')),
            ],
            options={
                'verbose_name': '8D Prevention Action',
                'verbose_name_plural': '8D Prevention Actions',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='EightDContainmentAction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action_description', models.TextField(help_text='Detailed description of the interim containment action', verbose_name='Containment Action Description')),
                ('rationale', models.TextField(help_text='Why this containment action was chosen', verbose_name='Rationale')),
                ('implementation_date', models.DateTimeField(blank=True, null=True, verbose_name='Implementation Date')),
                ('verification_date', models.DateTimeField(blank=True, null=True, verbose_name='Verification Date')),
                ('status', models.CharField(choices=[('planned', 'Planned'), ('implemented', 'Implemented'), ('verified', 'Verified'), ('ineffective', 'Ineffective')], default='planned', max_length=20, verbose_name='Status')),
                ('effectiveness_rating', models.IntegerField(blank=True, help_text='Rate effectiveness from 1 (poor) to 5 (excellent)', null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(5)], verbose_name='Effectiveness Rating')),
                ('verification_notes', models.TextField(blank=True, help_text='Notes on verification of containment effectiveness', verbose_name='Verification Notes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('responsible_person', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='containment_actions_responsible', to=settings.AUTH_USER_MODEL)),
                ('eight_d_process', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='containment_actions', to='incidentmanagement.eightdprocess')),
            ],
            options={
                'verbose_name': '8D Containment Action',
                'verbose_name_plural': '8D Containment Actions',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='EightDRootCause',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('cause_description', models.TextField(help_text='Detailed description of the identified cause', verbose_name='Cause Description')),
                ('cause_type', models.CharField(choices=[('immediate', 'Immediate Cause'), ('contributing', 'Contributing Cause'), ('root', 'Root Cause'), ('systemic', 'Systemic Cause')], default='contributing', max_length=20, verbose_name='Cause Type')),
                ('analysis_method', models.CharField(choices=[('5_whys', '5 Whys'), ('fishbone', 'Fishbone Diagram'), ('fault_tree', 'Fault Tree Analysis'), ('barrier_analysis', 'Barrier Analysis'), ('change_analysis', 'Change Analysis'), ('timeline', 'Timeline Analysis'), ('other', 'Other Method')], help_text='Method used to identify this cause', max_length=20, verbose_name='Analysis Method')),
                ('supporting_evidence', models.TextField(help_text='Evidence that supports this cause identification', verbose_name='Supporting Evidence')),
                ('verification_method', models.TextField(help_text='How this cause was verified', verbose_name='Verification Method')),
                ('is_verified', models.BooleanField(default=False, verbose_name='Is Verified')),
                ('impact_assessment', models.TextField(blank=True, help_text="Assessment of this cause's impact on the problem", verbose_name='Impact Assessment')),
                ('likelihood_score', models.IntegerField(blank=True, help_text='Likelihood this cause contributed (1-5 scale)', null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(5)], verbose_name='Likelihood Score')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('eight_d_process', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='root_causes', to='incidentmanagement.eightdprocess')),
                ('identified_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='root_causes_identified', to=settings.AUTH_USER_MODEL)),
                ('verified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='root_causes_verified', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': '8D Root Cause',
                'verbose_name_plural': '8D Root Causes',
                'ordering': ['cause_type', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='EightDCorrectiveAction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action_description', models.TextField(help_text='Detailed description of the permanent corrective action', verbose_name='Corrective Action Description')),
                ('action_type', models.CharField(choices=[('eliminate', 'Eliminate Root Cause'), ('control', 'Control Root Cause'), ('detect', 'Improve Detection'), ('prevent', 'Prevent Occurrence')], default='eliminate', max_length=20, verbose_name='Action Type')),
                ('rationale', models.TextField(help_text='Why this corrective action was chosen', verbose_name='Rationale')),
                ('target_date', models.DateField(verbose_name='Target Implementation Date')),
                ('actual_implementation_date', models.DateField(blank=True, null=True, verbose_name='Actual Implementation Date')),
                ('status', models.CharField(choices=[('planned', 'Planned'), ('approved', 'Approved'), ('in_progress', 'In Progress'), ('implemented', 'Implemented'), ('verified', 'Verified'), ('effective', 'Effective'), ('ineffective', 'Ineffective')], default='planned', max_length=20, verbose_name='Status')),
                ('implementation_notes', models.TextField(blank=True, help_text='Notes on implementation progress and challenges', verbose_name='Implementation Notes')),
                ('implementation_plan', models.TextField(blank=True, help_text='Detailed plan for implementing this corrective action', verbose_name='Implementation Plan')),
                ('implementation_start_date', models.DateField(blank=True, null=True, verbose_name='Implementation Start Date')),
                ('implementation_progress', models.IntegerField(default=0, help_text='Implementation progress percentage (0-100)', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Implementation Progress')),
                ('progress_notes', models.TextField(blank=True, help_text='Latest progress notes and updates', verbose_name='Progress Notes')),
                ('completion_evidence', models.TextField(blank=True, help_text='Evidence of implementation completion', verbose_name='Completion Evidence')),
                ('resources_required', models.TextField(blank=True, help_text='Resources needed to implement the action', verbose_name='Resources Required')),
                ('verification_method', models.TextField(blank=True, help_text='How effectiveness will be/was verified', verbose_name='Verification Method')),
                ('verification_date', models.DateField(blank=True, null=True, verbose_name='Verification Date')),
                ('validation_results', models.TextField(blank=True, help_text='Results of action validation', verbose_name='Validation Results')),
                ('effectiveness_rating', models.IntegerField(blank=True, help_text='Rate effectiveness from 1 (poor) to 5 (excellent)', null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(5)], verbose_name='Effectiveness Rating')),
                ('verification_notes', models.TextField(blank=True, help_text='Results of effectiveness verification', verbose_name='Verification Notes')),
                ('estimated_cost', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True, verbose_name='Estimated Cost')),
                ('actual_cost', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True, verbose_name='Actual Cost')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('responsible_person', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='corrective_actions_responsible', to=settings.AUTH_USER_MODEL)),
                ('eight_d_process', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='corrective_actions', to='incidentmanagement.eightdprocess')),
                ('root_cause', models.ForeignKey(help_text='Root cause this action addresses', on_delete=django.db.models.deletion.CASCADE, related_name='corrective_actions', to='incidentmanagement.eightdrootcause')),
            ],
            options={
                'verbose_name': '8D Corrective Action',
                'verbose_name_plural': '8D Corrective Actions',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Incident',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('incident_id', models.CharField(help_text='Auto-generated unique incident identifier', max_length=20, unique=True, verbose_name='Incident ID')),
                ('title', models.CharField(max_length=255, validators=[django.core.validators.MinLengthValidator(5)], verbose_name='Incident Title')),
                ('description', models.TextField(help_text='Detailed description of the incident (10-1000 characters)', validators=[django.core.validators.MinLengthValidator(10), django.core.validators.MaxLengthValidator(1000)], verbose_name='Description')),
                ('incident_type', models.CharField(choices=[('injury', 'Injury'), ('near_miss', 'Near Miss'), ('spill', 'Spill'), ('fire', 'Fire'), ('explosion', 'Explosion'), ('property_damage', 'Property Damage'), ('environmental', 'Environmental'), ('security', 'Security'), ('vehicle_accident', 'Vehicle Accident'), ('equipment_failure', 'Equipment Failure'), ('chemical_exposure', 'Chemical Exposure'), ('ergonomic', 'Ergonomic'), ('electrical', 'Electrical'), ('fall_from_height', 'Fall from Height'), ('struck_by_object', 'Struck by Object'), ('caught_in_between', 'Caught In/Between'), ('other', 'Other')], max_length=20, verbose_name='Incident Type')),
                ('severity_level', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('critical', 'Critical')], max_length=10, verbose_name='Severity Level')),
                ('status', models.CharField(choices=[('reported', 'Reported'), ('8d_initiated', '8D Process Initiated'), ('8d_in_progress', '8D Process In Progress'), ('8d_completed', '8D Process Completed'), ('closed', 'Closed'), ('cancelled', 'Cancelled')], default='reported', max_length=20, verbose_name='Status')),
                ('location', models.CharField(max_length=255, verbose_name='Location')),
                ('department', models.CharField(max_length=100, verbose_name='Department')),
                ('date_time_incident', models.DateTimeField(verbose_name='Date & Time of Incident')),
                ('reporter_name', models.CharField(max_length=100, validators=[django.core.validators.MinLengthValidator(2)], verbose_name='Reporter Name')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('immediate_action_taken', models.TextField(blank=True, help_text='Actions taken immediately after the incident', verbose_name='Immediate Action Taken')),
                ('potential_causes', models.TextField(blank=True, help_text='Initial assessment of potential causes', verbose_name='Potential Causes')),
                ('risk_level', models.CharField(blank=True, choices=[('very_low', 'Very Low'), ('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('very_high', 'Very High')], help_text='Overall risk level assessment', max_length=20, verbose_name='Risk Level')),
                ('probability_score', models.IntegerField(blank=True, help_text='Probability of recurrence (1-5 scale)', null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(5)], verbose_name='Probability Score')),
                ('impact_score', models.IntegerField(blank=True, help_text='Severity of impact (1-5 scale)', null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(5)], verbose_name='Impact Score')),
                ('risk_matrix_score', models.IntegerField(blank=True, help_text='Calculated risk score (probability Ã— impact)', null=True, verbose_name='Risk Matrix Score')),
                ('estimated_cost', models.DecimalField(blank=True, decimal_places=2, help_text='Estimated financial impact', max_digits=12, null=True, verbose_name='Estimated Cost')),
                ('actual_cost', models.DecimalField(blank=True, decimal_places=2, help_text='Actual financial impact', max_digits=12, null=True, verbose_name='Actual Cost')),
                ('cost_category', models.CharField(blank=True, choices=[('medical', 'Medical'), ('property_damage', 'Property Damage'), ('property_repair', 'Property Repair'), ('equipment_replacement', 'Equipment Replacement'), ('production_loss', 'Production Loss'), ('overtime', 'Overtime Costs'), ('contractor_fees', 'Contractor Fees'), ('legal_fees', 'Legal Fees'), ('regulatory_fine', 'Regulatory Fine'), ('environmental_cleanup', 'Environmental Cleanup'), ('investigation_costs', 'Investigation Costs'), ('training_costs', 'Training Costs'), ('other', 'Other')], max_length=50, verbose_name='Cost Category')),
                ('regulatory_framework', models.CharField(blank=True, choices=[('osha', 'OSHA'), ('iso_45001', 'ISO 45001'), ('iso_14001', 'ISO 14001'), ('local_regulation', 'Local Regulation'), ('company_policy', 'Company Policy'), ('other', 'Other')], max_length=30, verbose_name='Regulatory Framework')),
                ('regulatory_reportable', models.BooleanField(default=False, help_text='Must be reported to regulatory authorities', verbose_name='Regulatory Reportable')),
                ('regulatory_report_date', models.DateTimeField(blank=True, null=True, verbose_name='Regulatory Report Date')),
                ('regulatory_reference', models.CharField(blank=True, help_text='Reference number from regulatory authority', max_length=100, verbose_name='Regulatory Reference')),
                ('business_impact', models.CharField(blank=True, choices=[('none', 'None'), ('minimal', 'Minimal'), ('moderate', 'Moderate'), ('significant', 'Significant'), ('severe', 'Severe')], max_length=20, verbose_name='Business Impact')),
                ('production_impact_hours', models.DecimalField(blank=True, decimal_places=2, max_digits=8, null=True, verbose_name='Production Impact (Hours)')),
                ('personnel_affected_count', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0)], verbose_name='Personnel Affected Count')),
                ('escalation_level', models.IntegerField(default=1, help_text='Current escalation level (1-5)', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(5)], verbose_name='Escalation Level')),
                ('priority_score', models.IntegerField(blank=True, help_text='Calculated priority score for resource allocation', null=True, verbose_name='Priority Score')),
                ('external_agencies_notified', models.JSONField(blank=True, default=list, help_text='List of external agencies that were notified', verbose_name='External Agencies Notified')),
                ('weather_conditions', models.CharField(blank=True, max_length=100, verbose_name='Weather Conditions')),
                ('environmental_factors', models.TextField(blank=True, help_text='Environmental conditions that may have contributed', verbose_name='Environmental Factors')),
                ('equipment_involved', models.TextField(blank=True, help_text='Equipment, tools, or machinery involved in the incident', verbose_name='Equipment Involved')),
                ('equipment_serial_numbers', models.TextField(blank=True, verbose_name='Equipment Serial Numbers')),
                ('work_process', models.CharField(blank=True, help_text='Specific work process being performed', max_length=200, verbose_name='Work Process')),
                ('work_permit_number', models.CharField(blank=True, max_length=50, verbose_name='Work Permit Number')),
                ('safety_procedures_followed', models.BooleanField(blank=True, null=True, verbose_name='Safety Procedures Followed')),
                ('management_notified_at', models.DateTimeField(blank=True, null=True, verbose_name='Management Notified At')),
                ('family_notified', models.BooleanField(default=False, verbose_name='Family Notified')),
                ('media_attention', models.BooleanField(default=False, verbose_name='Media Attention')),
                ('regulatory_report_required', models.BooleanField(default=False, verbose_name='Regulatory Report Required')),
                ('regulatory_body', models.CharField(blank=True, max_length=100, verbose_name='Regulatory Body')),
                ('is_biodiversity_event', models.BooleanField(default=False, verbose_name='Is Biodiversity Event')),
                ('environmental_severity', models.CharField(blank=True, choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('critical', 'Critical')], max_length=10, verbose_name='Environmental Severity')),
                ('assigned_investigator', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='incidents_investigating', to=settings.AUTH_USER_MODEL, verbose_name='Assigned Investigator')),
                ('project', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='incidents', to='authentication.project')),
                ('reported_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='incidents_reported', to=settings.AUTH_USER_MODEL, verbose_name='Reported By')),
            ],
            options={
                'verbose_name': 'Incident',
                'verbose_name_plural': 'Incidents',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='eightdprocess',
            name='incident',
            field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='eight_d_process', to='incidentmanagement.incident'),
        ),
        migrations.CreateModel(
            name='IncidentAttachment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('file', models.FileField(upload_to='incident_attachments/%Y/%m/', verbose_name='File')),
                ('filename', models.CharField(max_length=255, verbose_name='Original Filename')),
                ('file_size', models.PositiveIntegerField(verbose_name='File Size (bytes)')),
                ('file_type', models.CharField(max_length=50, verbose_name='File Type')),
                ('description', models.CharField(blank=True, help_text='Optional description of the attachment', max_length=255, verbose_name='Description')),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('incident', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attachments', to='incidentmanagement.incident')),
                ('uploaded_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='incident_attachments', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Incident Attachment',
                'verbose_name_plural': 'Incident Attachments',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='IncidentAuditLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action', models.CharField(choices=[('created', 'Created'), ('updated', 'Updated'), ('status_changed', 'Status Changed'), ('assigned', 'Assigned'), ('investigation_started', 'Investigation Started'), ('investigation_completed', 'Investigation Completed'), ('capa_created', 'CAPA Created'), ('capa_completed', 'CAPA Completed'), ('closed', 'Closed'), ('reopened', 'Reopened')], max_length=30, verbose_name='Action')),
                ('description', models.TextField(verbose_name='Description')),
                ('timestamp', models.DateTimeField(auto_now_add=True)),
                ('previous_value', models.TextField(blank=True, null=True, verbose_name='Previous Value')),
                ('new_value', models.TextField(blank=True, null=True, verbose_name='New Value')),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True, verbose_name='IP Address')),
                ('user_agent', models.TextField(blank=True, verbose_name='User Agent')),
                ('incident', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='audit_logs', to='incidentmanagement.incident')),
                ('performed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='incident_actions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Incident Audit Log',
                'verbose_name_plural': 'Incident Audit Logs',
                'ordering': ['-timestamp'],
            },
        ),
        migrations.CreateModel(
            name='IncidentCostCenter',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('cost_type', models.CharField(choices=[('medical', 'Medical Treatment'), ('property_repair', 'Property Repair'), ('equipment_replacement', 'Equipment Replacement'), ('production_loss', 'Production Loss'), ('overtime', 'Overtime Costs'), ('contractor_fees', 'Contractor Fees'), ('legal_fees', 'Legal Fees'), ('regulatory_fine', 'Regulatory Fine'), ('environmental_cleanup', 'Environmental Cleanup'), ('investigation_costs', 'Investigation Costs'), ('training_costs', 'Training Costs'), ('other', 'Other')], max_length=50, verbose_name='Cost Type')),
                ('description', models.CharField(max_length=255, verbose_name='Description')),
                ('estimated_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='Estimated Amount')),
                ('actual_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, verbose_name='Actual Amount')),
                ('budget_code', models.CharField(blank=True, max_length=50, verbose_name='Budget Code')),
                ('department_charged', models.CharField(blank=True, max_length=100, verbose_name='Department Charged')),
                ('requires_approval', models.BooleanField(default=False, verbose_name='Requires Approval')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name='Approved At')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='cost_approvals', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='cost_entries_created', to=settings.AUTH_USER_MODEL)),
                ('incident', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='cost_centers', to='incidentmanagement.incident')),
            ],
            options={
                'verbose_name': 'Incident Cost Center',
                'verbose_name_plural': 'Incident Cost Centers',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='IncidentLearning',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('key_findings', models.TextField(help_text='Main findings from the incident investigation', verbose_name='Key Findings')),
                ('lessons_learned', models.TextField(help_text='Key lessons that can be applied to prevent similar incidents', verbose_name='Lessons Learned')),
                ('best_practices', models.TextField(blank=True, help_text='Best practices identified or reinforced', verbose_name='Best Practices')),
                ('applicable_to', models.JSONField(default=list, help_text='Departments, processes, or areas where these lessons apply', verbose_name='Applicable To')),
                ('training_required', models.BooleanField(default=False, verbose_name='Training Required')),
                ('training_topics', models.TextField(blank=True, help_text='Specific training topics identified', verbose_name='Training Topics')),
                ('policy_updates_required', models.BooleanField(default=False, verbose_name='Policy Updates Required')),
                ('policy_recommendations', models.TextField(blank=True, help_text='Recommended policy or procedure updates', verbose_name='Policy Recommendations')),
                ('shared_with_teams', models.JSONField(default=list, help_text='Teams or departments this learning has been shared with', verbose_name='Shared With Teams')),
                ('communication_method', models.CharField(blank=True, choices=[('toolbox_talk', 'Toolbox Talk'), ('safety_meeting', 'Safety Meeting'), ('newsletter', 'Newsletter'), ('training_session', 'Training Session'), ('bulletin_board', 'Bulletin Board'), ('email', 'Email'), ('other', 'Other')], max_length=50, verbose_name='Communication Method')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='learnings_created', to=settings.AUTH_USER_MODEL)),
                ('incident', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='learning', to='incidentmanagement.incident')),
            ],
            options={
                'verbose_name': 'Incident Learning',
                'verbose_name_plural': 'Incident Learnings',
            },
        ),
        migrations.CreateModel(
            name='IncidentMetrics',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('time_to_report', models.DurationField(blank=True, help_text='Time from incident occurrence to reporting', null=True, verbose_name='Time to Report')),
                ('time_to_investigate', models.DurationField(blank=True, help_text='Time from reporting to investigation start', null=True, verbose_name='Time to Investigate')),
                ('time_to_close', models.DurationField(blank=True, help_text='Total time from reporting to closure', null=True, verbose_name='Time to Close')),
                ('investigation_quality_score', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(10)], verbose_name='Investigation Quality Score')),
                ('capa_effectiveness_score', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(10)], verbose_name='CAPA Effectiveness Score')),
                ('is_recurrence', models.BooleanField(default=False, verbose_name='Is Recurrence')),
                ('regulatory_compliance_score', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(10)], verbose_name='Regulatory Compliance Score')),
                ('calculated_at', models.DateTimeField(auto_now=True)),
                ('incident', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='metrics', to='incidentmanagement.incident')),
                ('related_incidents', models.ManyToManyField(blank=True, help_text='Related or similar incidents', related_name='related_to', to='incidentmanagement.incident')),
            ],
            options={
                'verbose_name': 'Incident Metrics',
                'verbose_name_plural': 'Incident Metrics',
            },
        ),
        migrations.CreateModel(
            name='IncidentNotification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('notification_type', models.CharField(choices=[('incident_created', 'Incident Created'), ('incident_assigned', 'Incident Assigned'), ('investigation_due', 'Investigation Due'), ('capa_due', 'CAPA Due'), ('capa_overdue', 'CAPA Overdue'), ('status_changed', 'Status Changed')], max_length=30, verbose_name='Notification Type')),
                ('message', models.TextField(verbose_name='Notification Message')),
                ('sent_at', models.DateTimeField(auto_now_add=True)),
                ('read_at', models.DateTimeField(blank=True, null=True, verbose_name='Read At')),
                ('incident', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notifications', to='incidentmanagement.incident')),
                ('recipient', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='incident_notifications', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Incident Notification',
                'verbose_name_plural': 'Incident Notifications',
                'ordering': ['-sent_at'],
            },
        ),
        migrations.CreateModel(
            name='IncidentWorkflow',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, verbose_name='Workflow Name')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('incident_types', models.JSONField(default=list, help_text='Incident types this workflow applies to', verbose_name='Applicable Incident Types')),
                ('workflow_steps', models.JSONField(default=list, help_text='Ordered list of workflow steps and their configurations', verbose_name='Workflow Steps')),
                ('escalation_rules', models.JSONField(default=dict, help_text='Rules for automatic escalation based on time and conditions', verbose_name='Escalation Rules')),
                ('notification_rules', models.JSONField(default=dict, help_text='Rules for automatic notifications at each step', verbose_name='Notification Rules')),
                ('is_active', models.BooleanField(default=True, verbose_name='Is Active')),
                ('is_default', models.BooleanField(default=False, verbose_name='Is Default')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='workflows_created', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Incident Workflow',
                'verbose_name_plural': 'Incident Workflows',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='RiskAssessmentTemplate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, verbose_name='Template Name')),
                ('incident_types', models.JSONField(default=list, help_text='List of incident types this template applies to', verbose_name='Applicable Incident Types')),
                ('risk_factors', models.JSONField(default=dict, help_text='Risk factors and their scoring criteria', verbose_name='Risk Factors')),
                ('probability_criteria', models.JSONField(default=dict, help_text='Criteria for probability scoring (1-5)', verbose_name='Probability Criteria')),
                ('impact_criteria', models.JSONField(default=dict, help_text='Criteria for impact scoring (1-5)', verbose_name='Impact Criteria')),
                ('is_default', models.BooleanField(default=False, verbose_name='Is Default Template')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='risk_templates_created', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Risk Assessment Template',
                'verbose_name_plural': 'Risk Assessment Templates',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='EightDDiscipline',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('discipline_number', models.IntegerField(choices=[(1, 'D1: Establish the Team'), (2, 'D2: Describe the Problem'), (3, 'D3: Develop Interim Containment Actions'), (4, 'D4: Determine Root Causes'), (5, 'D5: Develop Permanent Corrective Actions'), (6, 'D6: Implement Corrective Actions'), (7, 'D7: Prevent Recurrence'), (8, 'D8: Recognize the Team')], validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(8)], verbose_name='Discipline Number')),
                ('status', models.CharField(choices=[('not_started', 'Not Started'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('verified', 'Verified'), ('approved', 'Approved')], default='not_started', max_length=20, verbose_name='Status')),
                ('progress_percentage', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)], verbose_name='Progress (%)')),
                ('description', models.TextField(help_text='Detailed description of work done in this discipline', verbose_name='Description')),
                ('deliverables', models.TextField(blank=True, help_text='Key deliverables and outputs from this discipline', verbose_name='Deliverables')),
                ('start_date', models.DateTimeField(blank=True, null=True, verbose_name='Start Date')),
                ('target_date', models.DateTimeField(blank=True, null=True, verbose_name='Target Date')),
                ('completion_date', models.DateTimeField(blank=True, null=True, verbose_name='Completion Date')),
                ('verified_date', models.DateTimeField(blank=True, null=True, verbose_name='Verified Date')),
                ('verification_notes', models.TextField(blank=True, verbose_name='Verification Notes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_8d_disciplines', to=settings.AUTH_USER_MODEL)),
                ('verified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='verified_8d_disciplines', to=settings.AUTH_USER_MODEL)),
                ('eight_d_process', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='disciplines', to='incidentmanagement.eightdprocess')),
            ],
            options={
                'verbose_name': '8D Discipline',
                'verbose_name_plural': '8D Disciplines',
                'ordering': ['discipline_number'],
                'unique_together': {('eight_d_process', 'discipline_number')},
            },
        ),
        migrations.CreateModel(
            name='EightDAnalysisMethod',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('method_type', models.CharField(choices=[('5_whys', '5 Whys'), ('fishbone', 'Fishbone Diagram'), ('fault_tree', 'Fault Tree Analysis'), ('barrier_analysis', 'Barrier Analysis'), ('change_analysis', 'Change Analysis'), ('timeline', 'Timeline Analysis')], max_length=20, verbose_name='Analysis Method Type')),
                ('method_data', models.JSONField(default=dict, help_text='Method-specific analysis data', verbose_name='Method Data')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='analysis_methods_created', to=settings.AUTH_USER_MODEL)),
                ('root_cause', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='analysis_methods', to='incidentmanagement.eightdrootcause')),
            ],
            options={
                'verbose_name': '8D Analysis Method',
                'verbose_name_plural': '8D Analysis Methods',
                'unique_together': {('root_cause', 'method_type')},
            },
        ),
        migrations.CreateModel(
            name='EightDTeam',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('role', models.CharField(choices=[('champion', '8D Champion'), ('team_leader', 'Team Leader'), ('subject_expert', 'Subject Matter Expert'), ('process_owner', 'Process Owner'), ('quality_rep', 'Quality Representative'), ('technical_expert', 'Technical Expert'), ('member', 'Team Member'), ('sponsor', 'Sponsor (Site In-charge)')], default='member', max_length=20, verbose_name='Role')),
                ('expertise_area', models.CharField(blank=True, help_text='Area of expertise relevant to the problem', max_length=100, verbose_name='Expertise Area')),
                ('responsibilities', models.TextField(blank=True, help_text='Specific responsibilities in the 8D process', verbose_name='Responsibilities')),
                ('is_active', models.BooleanField(default=True, verbose_name='Is Active')),
                ('joined_date', models.DateTimeField(auto_now_add=True, verbose_name='Joined Date')),
                ('left_date', models.DateTimeField(blank=True, null=True, verbose_name='Left Date')),
                ('recognition_notes', models.TextField(blank=True, help_text='Recognition and appreciation notes (D8)', verbose_name='Recognition Notes')),
                ('recognized_date', models.DateTimeField(blank=True, null=True, verbose_name='Recognized Date')),
                ('eight_d_process', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='team_members', to='incidentmanagement.eightdprocess')),
                ('recognized_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='eight_d_recognitions_given', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='eight_d_teams', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': '8D Team Member',
                'verbose_name_plural': '8D Team Members',
                'unique_together': {('eight_d_process', 'user')},
            },
        ),
        migrations.AddIndex(
            model_name='incident',
            index=models.Index(fields=['incident_id'], name='incidentman_inciden_343000_idx'),
        ),
        migrations.AddIndex(
            model_name='incident',
            index=models.Index(fields=['status'], name='incidentman_status_c52219_idx'),
        ),
        migrations.AddIndex(
            model_name='incident',
            index=models.Index(fields=['severity_level'], name='incidentman_severit_05f592_idx'),
        ),
        migrations.AddIndex(
            model_name='incident',
            index=models.Index(fields=['date_time_incident'], name='incidentman_date_ti_d8cbbc_idx'),
        ),
        migrations.AddIndex(
            model_name='incidentauditlog',
            index=models.Index(fields=['incident', '-timestamp'], name='incidentman_inciden_cc88a3_idx'),
        ),
        migrations.AddIndex(
            model_name='incidentauditlog',
            index=models.Index(fields=['action'], name='incidentman_action_1fe1dc_idx'),
        ),
    ]
